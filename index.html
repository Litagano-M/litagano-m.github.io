<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Get a Pokémon</title>
		<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">

		<style>
			#pokemon-image-box {
				width: 200px;
				height: 125px;
				margin: 0px auto 10px auto;
				background-color: lightgreen;
				border-radius: 10px;
			}

			#pokemon-image {
				height: inherit;
				display: block;
				margin-left: auto;
				margin-right: auto;
			}

			#pokemon-name-box {
				width: 300px;
				height: 60px;
				margin: 10px auto;
				background-color: lightgreen;
				border-radius: 10px;
			}

			#pokemon-name {
				font-family: "Roboto", sans-serif;
				font-size: 40px;
				text-align: center;
				line-height: 60px;
			}

			#pokedex-number-entry {
				width: 250px;
				padding: 10px;
				margin: auto;
				background-color: lightgreen;
				border-radius: 10px;
			}

			#pokedex-number-entry-info {
				margin-bottom: 5px;
				font-family: "Roboto", sans-serif;
				text-align: center;
			}

			#pokedex-number-entry-form input {
				width: 50px;
				margin: auto;
				display: block;
			}

			#pokedex-number-entry-error {
				margin-top: 5px;
				display: none;
				font-family: "Roboto", sans-serif;
				font-size: 10px;
				text-align: center;
				color: red;
			}
		</style>
	</head>
	<body>
		<div id="pokemon-image-box">
			<img id="pokemon-image">
		</div>

		<div id="pokemon-name-box">
			<div id="pokemon-name"></div>
		</div>

		<div id="pokedex-number-entry">
			<div id="pokedex-number-entry-info">Enter a PokéDex number here:</div>
			<form id="pokedex-number-entry-form">
				<input type="text">
			</form>
			<div id="pokedex-number-entry-error"></div>
		</div>

    	<script type="text/javascript">
			var pokedexNumberEntryEl = document.getElementById("pokedex-number-entry-form");
			var currentTimeouts = [];

			pokedexNumberEntryEl.addEventListener("submit", function(e) {
				e.preventDefault();

				if (!isValidNumber(this.elements[0].value)) {
					var errorContainer = document.getElementById("pokedex-number-entry-error");

					errorContainer.textContent = "Please enter a number.";
					errorContainer.style.display = "block";

					for (var i = currentTimeouts.length - 1; i >= 0; i--) {
						window.clearTimeout(currentTimeouts[i + 1]);
					}

					currentTimeouts.push(window.setTimeout(function() {
						errorContainer.style.display = "none";
					}, 4000));

					console.log(currentTimeouts);
				} else {
					var xhr = new XMLHttpRequest();
					xhr.open("GET", "https://pokeapi.co/api/v2/pokemon/" + this.elements[0].value, true);
					xhr.send();
					xhr.addEventListener("readystatechange", processRequest, false);
				}
			});

			function processRequest(e) {
				if (this.readyState === 4 && this.status === 200) {
					var response = JSON.parse(this.responseText);
					var pokemonName =
						response.name.substring(0, 1).toUpperCase() +
						response.name.substring(1);

					console.log(response);
					document.getElementById("pokemon-name").textContent = pokemonName;
					document.getElementById("pokemon-image").setAttribute("src", response.sprites.front_default);
				}
			}

			function isValidNumber(input) {
				if (typeof input === "number") {
					return true;
				} else if (typeof input === "string") {
					for (var i = 0; i < input.length; i++) {
						if (isNaN(parseInt(input.charAt(i)))) {
							return false;
						}
					}

					return true;
				} else {
					return false;
				}
			}
		</script>
	</body>
</html>
